<!-- popup.html (DROP-IN REPLACEMENT) -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>PhoneBurner Companion</title>
    <style>
      :root {
        --bg: #0b1220;
        --card: #121b2e;
        --border: rgba(255, 255, 255, 0.1);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.7);
        --muted2: rgba(255, 255, 255, 0.55);
        --primary: #5b8cff;
        --primary2: #3e6ff0;
        --danger: #ff5b6e;
        --radius: 14px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        width: 350px;
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--text);
        font:
          13px/1.35 system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
      }
      .hidden {
        display: none !important;
      }

      .header {
        padding: 12px 14px;
        border-bottom: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .title {
        font-weight: 800;
        font-size: 13px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .subtle {
        color: var(--muted2);
        font-size: 12px;
      }
      .pill {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--border);
        color: var(--muted);
        white-space: nowrap;
      }

      .tabs {
        display: flex;
        gap: 8px;
        padding: 10px 12px;
        border-bottom: 1px solid var(--border);
      }
      .tab-btn {
        flex: 1;
        padding: 8px 10px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        color: var(--muted);
        cursor: pointer;
        font-weight: 700;
      }
      .tab-btn.active {
        background: rgba(91, 140, 255, 0.18);
        border-color: rgba(91, 140, 255, 0.55);
        color: var(--text);
      }

      .panel {
        display: none;
      }
      .panel.active {
        display: block;
      }
      .panel-wrap {
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 12px;
        box-shadow: 0 10px 22px rgba(0, 0, 0, 0.25);
      }
      .card-title {
        font-weight: 900;
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .status {
        margin-top: 6px;
        color: var(--muted);
        font-size: 12px;
        white-space: normal;
        word-break: break-word;
      }
      .help-text {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
      }

      label {
        display: block;
        margin: 10px 0 6px;
        color: var(--muted2);
        font-weight: 800;
        font-size: 11px;
        letter-spacing: 0.2px;
        text-transform: uppercase;
      }

      input[type="text"],
      input[type="password"] {
        width: 100%;
        padding: 9px 10px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text);
        outline: none;
      }
      input[type="text"]:focus,
      input[type="password"]:focus {
        border-color: rgba(91, 140, 255, 0.7);
        box-shadow: 0 0 0 3px rgba(91, 140, 255, 0.18);
      }

      button {
        width: 100%;
        padding: 9px 10px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        font-weight: 900;
        cursor: pointer;
        margin-top: 8px;
      }
      button.primary {
        background: linear-gradient(180deg, var(--primary), var(--primary2));
        border: 0;
      }
      button.danger {
        background: rgba(255, 91, 110, 0.18);
        border-color: rgba(255, 91, 110, 0.55);
        color: #ffd7dc;
      }
      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }

      /* Custom modal overlay */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.75);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      .modal-overlay.show {
        display: flex;
      }
      .modal-dialog {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
        max-width: 300px;
        width: 90%;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }
      .modal-title {
        font-weight: 900;
        font-size: 14px;
        margin-bottom: 10px;
      }
      .modal-message {
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 16px;
        line-height: 1.5;
        white-space: pre-wrap;
      }
      .modal-buttons {
        display: flex;
        gap: 8px;
      }
      .modal-buttons button {
        margin: 0;
        flex: 1;
      }
    </style>
  </head>

  <body>
    <!-- Custom modal dialog (replaces native alert/confirm) -->
    <div id="modal-overlay" class="modal-overlay">
      <div class="modal-dialog">
        <div id="modal-title" class="modal-title"></div>
        <div id="modal-message" class="modal-message"></div>
        <div id="modal-buttons" class="modal-buttons"></div>
      </div>
    </div>
    <div class="header">
      <div class="title">
        <div>
          Detected CRM:
          <span id="crm-name" style="font-weight: 900">Loading…</span>
        </div>
        <span id="crm-level" class="pill"></span>
      </div>

      <div class="subtle">
        <strong>PhoneBurner:</strong> <span id="pb-status">Checking...</span>
      </div>
    </div>

    <div class="tabs">
      <button id="tab-dial" class="tab-btn active">Dial</button>
      <button id="tab-settings" class="tab-btn">Settings</button>
    </div>

    <!-- Dial -->
    <div id="panel-dial" class="panel active">
      <div class="panel-wrap">
        <!-- PAT CONNECT (Dial only when NOT connected) -->
        <div id="pat-card-dial" class="card">
          <div class="card-title">PhoneBurner Access Token</div>
          <input type="password" id="pat" placeholder="Paste PAT here" />
          <button id="save-pat" class="primary">Save PAT</button>
          <div class="help-text">
            Paste your Personal Access Token to connect. Once connected, you can
            manage it in Settings.
          </div>
        </div>

        <!-- Get PhoneBurner (shown only when NOT connected) -->
        <div id="get-pb-card" class="card hidden">
          <div class="card-title">New to PhoneBurner?</div>
          <div class="help-text">
            This extension requires an active PhoneBurner account.
          </div>
          <button id="get-pb-btn" class="primary" style="margin-top: 10px">
            Get PhoneBurner
          </button>
        </div>

        <!-- Current Page (hidden on Level 3) -->
        <div id="card-current-page" class="card">
          <div class="card-title">Current Page</div>
          <div class="help-text">
            Scan this page for contacts and launch a dial session.
          </div>
          <button id="scan-launch" class="primary">
            Scan &amp; Launch Dial Session
          </button>
        </div>

        <!-- HubSpot Dial (Level 3 only) -->
        <div id="hubspot-dial-card" class="card hidden">
          <div class="card-title">
            HubSpot advanced mode <span class="pill">Level 3</span>
          </div>

          <div id="hs-dial-status" class="status"></div>
          <div id="hs-dial-help" class="help-text"></div>

          <!-- Single button for contacts/deals (existing behavior) -->
          <button id="hs-dial-action" class="primary hidden">Loading…</button>

          <!-- Two buttons for companies (new modes) -->
          <button id="hs-dial-contacts" class="primary hidden">
            Launch Dial Session (Contacts)
          </button>
          <button id="hs-dial-companies" class="primary hidden" style="margin-top: 8px;">
            Launch Dial Session (Companies)
          </button>

          <!-- HubSpot List Dial -->
          <div id="hs-list-section" class="hidden" style="margin-top: 12px; border-top: 1px solid var(--border); padding-top: 12px;">
            <div style="font-weight: 800; font-size: 11px; color: var(--muted2); text-transform: uppercase; letter-spacing: 0.2px; margin-bottom: 6px;">
              Or launch from a HubSpot list
            </div>
            <select id="hs-list-select" style="width:100%; padding:9px 10px; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,0.04); color:var(--text); font:inherit; outline:none; cursor:pointer;">
              <option value="">Select a list…</option>
            </select>
            <div id="hs-list-info" class="help-text" style="margin-top:4px;"></div>
            <button id="hs-dial-from-list" class="primary hidden" style="margin-top:8px;">
              Launch Dial Session from List
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings -->
    <div id="panel-settings" class="panel">
      <div class="panel-wrap">
        <!-- PAT MANAGEMENT (Settings only when connected) -->
        <div id="pat-card-settings" class="card hidden">
          <div class="card-title">PhoneBurner Connection</div>
          <div class="help-text">
            You’re connected to PhoneBurner. Use Disconnect to remove your saved
            token from this browser.
          </div>
          <button id="disconnect-pat" class="danger">Disconnect</button>
        </div>

        <!-- HubSpot Settings (only when HubSpot is connected) -->
        <div id="hubspot-settings-card" class="card hidden">
          <div class="card-title">HubSpot Connection</div>
          <div id="hs-settings-status" class="status"></div>
          <div class="help-text">
            Disconnecting removes the saved HubSpot authorization on the server
            for this browser session.
          </div>
          <button id="hs-disconnect" class="danger">Disconnect HubSpot</button>
        </div>

        <div class="card">
          <div class="card-title">Goal Dispositions</div>
          <div class="help-text">
            Set which PhoneBurner dispositions count as your primary and
            secondary "wins".
          </div>

          <label for="goal-primary">Primary Goal</label>
          <input type="text" id="goal-primary" placeholder="Set Appointment" />

          <label for="goal-secondary">Secondary Goal</label>
          <input type="text" id="goal-secondary" placeholder="Follow Up" />

          <button id="save-goals" class="primary">Save Goals</button>
          <div id="goals-status" class="status"></div>
        </div>

        <div class="card">
          <div class="card-title">Follow Widget</div>
          <div class="help-text" style="margin-top: 4px">
            Control how the on-screen “Follow” widget behaves after a dial
            session starts.
          </div>

          <label
            style="
              display: flex;
              align-items: center;
              gap: 8px;
              margin-top: 8px;
              font-size: 12px;
              text-transform: none;
              letter-spacing: 0;
            "
          >
            <input type="checkbox" id="follow-auto-collapse" />
            Auto-collapse after session starts
          </label>

          <div class="help-text" style="margin-top: 6px">
            Default: On. The widget will briefly expand, then collapse to a
            small view.
          </div>
        </div>
      </div>
    </div>

    <script src="popup.js"></script>
  </body>
</html>
